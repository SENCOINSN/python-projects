#!/usr/bin/env python3

import os
import datetime
import json 

def convertDate(timestamp):
    d = datetime.datetime.timestamp(timestamp)
    return d.strftime('%Y-%m-%d %H:%M:%S')

def getDirDetails(path:os.getcwd()): # type: ignore
    fileList=[]
    
    pathExists =  os.path.exists(path)
    
    isFile = os.path.isfile(path)
    
    isDir = os.path.isdir(path)
    
    if pathExists and isDir:
        for root, dirs, files in os.walk(path):
            for file in files:
              filePath = os.path.join(root, file)  
              #get file size
              fileSize = round(os.path.getsize(filePath)/1024, 1)
              fileCreateTime = convertDate(os.path.getctime(filePath))
              
              fileDict = {
                "file":file,  
                "filePath": filePath,
                "fileSize": fileSize,
                "fileCreateTime": fileCreateTime,
              }
              fileList.append(fileDict)
              
        pathFilesJson = json.dumps(fileList,ident=4)
            
        return pathFilesJson
    
    elif pathExists and isFile:
        print(f"Error: the path '{path}' is not a directory")
        
    elif not pathExists:
        print(f"Error: the path '{path}' does not exist")


if __name__ == "__main__":
   path = os.path.expanduser("~")
   print(getDirDetails(path))